<!doctype html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Triangulacja z wizualizacją</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 600px;
        margin: auto;
      }
      label {
        display: block;
        margin-top: 10px;
      }
      input[type="number"] {
        width: 100%;
        padding: 5px;
        margin-top: 5px;
      }
      button {
        margin-top: 15px;
        padding: 10px;
        width: 100%;
      }
      #wynik {
        margin-top: 20px;
        font-weight: bold;
      }
      #canvasContainer {
        text-align: center;
        margin-top: 30px;
      }
      canvas {
        border: 1px solid #ccc;
        background: #f9f9f9;
      }
    </style>
  </head>
  <body>
    <h1>Triangulacja z wizualizacją</h1>
    <p>Wpisz dane i zobacz położenie punktu C oraz kąty.</p>

    <form id="triangulacjaForm">
      <label>
        Odległość AB (m):
        <input
          type="number"
          id="odlegloscAB"
          value="1000"
          min="0"
          step="any"
          required
        />
      </label>

      <label>
        Kąt α przy punkcie A (stopnie):
        <input
          type="number"
          id="katAlfa"
          value="30"
          min="0"
          max="180"
          step="any"
          required
        />
      </label>

      <label>
        Kąt β przy punkcie B (stopnie):
        <input
          type="number"
          id="katBeta"
          value="45"
          min="0"
          max="180"
          step="any"
          required
        />
      </label>
    </form>

    <div id="wynik"></div>

    <div id="canvasContainer">
      <canvas id="canvas" width="500" height="400"></canvas>
    </div>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      let dragging = false;
      let draggedPoint = null;
      let pointC = null;

      const currentState = {
        scale: 0.3,
        margin: 40,
      };

      // Konwersja między współrzędnymi
      function screenToWorld(x, y) {
        return {
          x: (x - currentState.margin) / currentState.scale,
          y: (canvas.height - currentState.margin - y) / currentState.scale,
        };
      }

      function worldToScreen(x, y) {
        return {
          x: currentState.margin + x * currentState.scale,
          y: canvas.height - currentState.margin - y * currentState.scale,
        };
      }

      // Triangulacja na podstawie długości AB i kątów
      function triangulacja(c, alfaDeg, betaDeg) {
        const alfa = (alfaDeg * Math.PI) / 180;
        const beta = (betaDeg * Math.PI) / 180;

        const a = (Math.sin(beta) * c) / Math.sin(alfa + beta);
        const b = (Math.sin(alfa) * c) / Math.sin(alfa + beta);

        const Cx = a * Math.cos(alfa);
        const Cy = a * Math.sin(alfa);

        return { x: Cx, y: Cy };
      }

      // Rysowanie sceny
      function drawScene(c, alfaDeg, betaDeg, C) {
        pointC = C; // aktualizujemy globalną zmienną

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const A = { x: 0, y: 0 };
        const B = { x: c, y: 0 };

        const As = worldToScreen(A.x, A.y);
        const Bs = worldToScreen(B.x, B.y);
        const Cs = worldToScreen(C.x, C.y);

        // Linie
        ctx.strokeStyle = "#000";
        ctx.beginPath();
        ctx.moveTo(As.x, As.y);
        ctx.lineTo(Bs.x, Bs.y);
        ctx.lineTo(Cs.x, Cs.y);
        ctx.lineTo(As.x, As.y);
        ctx.stroke();

        // Punkty
        drawPoint(As, "A");
        drawPoint(Bs, "B");
        drawPoint(Cs, "C");

        // Odległości
        drawDistanceMidpoint(As, Cs, "AC");
        drawDistanceMidpoint(Bs, Cs, "BC");
      }

      function drawPoint(p, label) {
        ctx.fillStyle = "#000";
        ctx.beginPath();
        ctx.arc(p.x, p.y, 5, 0, 2 * Math.PI);
        ctx.fill();
        ctx.fillText(label, p.x + 8, p.y - 8);
      }

      function drawDistanceMidpoint(p1, p2, label) {
        const mx = (p1.x + p2.x) / 2;
        const my = (p1.y + p2.y) / 2;
        const dist = Math.hypot(p2.x - p1.x, p2.y - p1.y) / currentState.scale;

        // Tło
        ctx.fillStyle = "#fff";
        ctx.fillRect(mx - 20, my - 10, 40, 16);

        ctx.fillStyle = "#00f";
        ctx.fillText(label + ": " + dist.toFixed(0) + " m", mx - 18, my + 4);
      }

      // Obsługa myszy
      canvas.addEventListener("mousedown", (e) => {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;

        if (pointC) {
          const Cs = worldToScreen(pointC.x, pointC.y);
          const distance = Math.hypot(mx - Cs.x, my - Cs.y);

          if (distance < 10) {
            dragging = true;
            draggedPoint = "C";
            canvas.style.cursor = "grabbing";
          }
        }
      });

      canvas.addEventListener("mouseup", () => {
        dragging = false;
        draggedPoint = null;
        canvas.style.cursor = "default";
      });

      canvas.addEventListener("mousemove", (e) => {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;

        if (pointC) {
          const Cs = worldToScreen(pointC.x, pointC.y);
          const distance = Math.hypot(mx - Cs.x, my - Cs.y);
          if (distance < 10 || dragging) {
            canvas.style.cursor = dragging ? "grabbing" : "grab";
          } else {
            canvas.style.cursor = "default";
          }
        }

        if (!dragging) return;

        if (draggedPoint === "C") {
          const world = screenToWorld(mx, my);
          const Cx = world.x;
          const Cy = world.y;

          const A = { x: 0, y: 0 };
          const B = {
            x: parseFloat(document.getElementById("odlegloscAB").value) || 1000,
            y: 0,
          };

          const a = Math.hypot(B.x - Cx, B.y - Cy); // BC
          const b = Math.hypot(Cx - A.x, Cy - A.y); // AC
          const c = B.x - A.x;

          const alfa = Math.acos((b ** 2 + c ** 2 - a ** 2) / (2 * b * c));
          const beta = Math.acos((a ** 2 + c ** 2 - b ** 2) / (2 * a * c));

          const alfaDeg = (alfa * 180) / Math.PI;
          const betaDeg = (beta * 180) / Math.PI;

          document.getElementById("katAlfa").value = alfaDeg.toFixed(2);
          document.getElementById("katBeta").value = betaDeg.toFixed(2);

          const wynik = triangulacja(c, alfaDeg, betaDeg);
          if (wynik) {
            drawScene(c, alfaDeg, betaDeg, wynik);
          }
        }
      });

      // Inicjalizacja
      document
        .getElementById("katAlfa")
        .addEventListener("input", updateFromInputs);
      document
        .getElementById("katBeta")
        .addEventListener("input", updateFromInputs);
      document
        .getElementById("odlegloscAB")
        .addEventListener("input", updateFromInputs);

      function updateFromInputs() {
        const c =
          parseFloat(document.getElementById("odlegloscAB").value) || 1000;
        const alfaDeg =
          parseFloat(document.getElementById("katAlfa").value) || 45;
        const betaDeg =
          parseFloat(document.getElementById("katBeta").value) || 45;
        const wynik = triangulacja(c, alfaDeg, betaDeg);
        if (wynik) {
          drawScene(c, alfaDeg, betaDeg, wynik);
        }
      }

      // Start
      updateFromInputs();
    </script>
  </body>
</html>
